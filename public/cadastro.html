<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/cadastro.css">
    <script src="js/cep.js"></script>
</head>

<body>
    <div class="login-banner">
        <div class="header">
            <div class="container">
                <h1 class="titulo">Korean Music</h1>
                <ul class="navbar">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="cadastro.html">Cadastro</a></li>
                </ul>
            </div>
        </div>
        <div class="container">
            <div class="alerta_erro">
                <div class="card_erro" id="cardErro">
                    <span id="mensagem_erro"></span>
                </div>
            </div>
            <!-- FORMULARIO CADASTRO -->
            <div class="form-cadastro" id="formCadastro">
                <div class="form-title">
                    <h2>Faça o seu cadastro</h2>
                </div>
                <div class="cadastro-campos">
                    <div class="campo-duplo">
                        <div class="campo">
                            <span class="nome_campo">Nome</span>
                            <input type="text" id="ipt_nome" placeholder="Nome">
                        </div>
                        <div class="campo">
                            <span class="nome_campo">Sobrenome</span>
                            <input type="text" id="ipt_sobrenome" placeholder="Sobrenome">
                        </div>
                    </div>
                    <div class="campo-duplo">
                        <div class="campo">
                            <span class="nome_campo">E-mail</span>
                            <input type="email" id="ipt_email" placeholder="E-mail">
                        </div>
                        <div class="campo">
                            <span class="nome_campo">Data de Nascimento</span>
                            <input type="text" id="ipt_datanasc" placeholder="DD/MM/AA">
                        </div>
                    </div>
                    <div class="campo-duplo">
                        <div class="campo">
                            <span class="nome_campo">Senha</span>
                            <input type="password" id="ipt_pass" placeholder="******">
                        </div>
                        <div class="campo">
                            <span class="nome_campo">Confirmar senha</span>
                            <input type="password" id="ipt_verpass" placeholder="******">
                        </div>
                    </div>
                    <div class="campo">
                        <span class="nome_campo">Grupo favorito:</span>
                        <select id="sel_grupo">
                            <option value="1">BTS</option>
                            <option value="2">TWICE</option>
                            <option value="3">NCT</option>
                            <option value="4">BLACKPINK</option>
                            <option value="5">EXO</option>
                            <option value="6">ITZY</option>
                        </select>
                    </div>
                    <div class="btn_forgot">
                        <!-- <span class="forgot_pass"><a href="#">Esqueceu a senha?</a></span> -->
                        <button onclick="prox()">Próximo</button>
                    </div>
                    <span class="criar_acc">Já tem uma conta? <a href="#">Fazer login!</a></span>
                    <div id="div_erros"><span id="span_erro"></span></div>
                </div>
                <div class="endereco-campos">
                    <div class="campo-duplo"></div>
                </div>
            </div>
            <!-- FORMULARIO CADASTRO -->
            <!-- FORMULARIO ENDEREÇO -->
            <div class="form-endereco" id="formEndereco">
                <div class="form-title">
                    <h2>Preencha os dados do seu endereço</h2>
                </div>
                <div class="cadastro-campos">
                    <div class="campo-duplo">
                        <div class="campo">
                            <span class="nome_campo">CEP</span>
                            <input type="text" id="ipt_cep" placeholder="CEP" maxlength="9" onblur="buscaCEP()">
                        </div>
                        <div class="campo">
                            <span class="nome_campo">Rua</span>
                            <input type="text" id="ipt_rua" placeholder="Rua">
                        </div>
                    </div>
                    <div class="campo-duplo">
                        <div class="campo">
                            <span class="nome_campo">Bairro</span>
                            <input type="email" id="ipt_bairro" placeholder="Bairro">
                        </div>
                        <div class="campo">
                            <span class="nome_campo">Cidade</span>
                            <input type="text" id="ipt_cidade" placeholder="Cidade">
                        </div>
                    </div>
                    <div class="campo-duplo">
                        <div class="campo">
                            <span class="nome_campo">Estado</span>
                            <input type="text" id="ipt_estado" placeholder="Estado">
                        </div>
                        <div class="campo">
                            <span class="nome_campo">Número</span>
                            <input type="text" id="ipt_num" placeholder="Número">
                        </div>
                    </div>
                    <div class="btn_forgot">
                        <!-- <span class="forgot_pass"><a href="#">Esqueceu a senha?</a></span> -->
                        <button onclick="cadastrar()">Cadastrar</button>
                    </div>
                    <span class="criar_acc">Já tem uma conta? <a href="#">Fazer login!</a></span>
                    <div id="div_errosEnd"><span id="span_erroEnd"></span></div>
                </div>
            </div>
            <!-- FORMULARIO ENDEREÇO -->
        </div>
    </div>
</body>

</html>

<script>
    // TODO: CONFIGURAR MASCARA DE ENTRADA CAMPO INPUT DATA PARA DD-MM-YYYY
    // ALTERAR ELA PARA O PADRÃO DO BANCO DE DADOS MYSQL YYYY-MM-DD
    
    function prox() {
        formCadastro.style.display = 'none'
        formEndereco.style.display = 'flex'
    }

    function cadastrar() {
        var nomeVar = ipt_nome.value
        var sobrenomeVar = ipt_sobrenome.value
        var emailVar = ipt_email.value
        var dtNascVar = ipt_datanasc.value
        var senhaVar = ipt_pass.value
        var confSenha = ipt_verpass.value
        var favGroupVar = sel_grupo.value

        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nomeServer: nomeVar,
                sobrenomeServer: sobrenomeVar,
                emailServer: emailVar,
                dtNascServer: dtNascVar,
                senhaServer: senhaVar,
                favGroupServer: favGroupVar
            })
        }).then(function (resposta) {
            console.log("resposta: ", resposta)

            if (resposta.ok) {
                alert("Cadastro realizado com sucesso!")
                
                setTimeout(() => {
                    window.location = "login.html"
                }, "2000");
            } else {
                resposta.text().then(texto => {
                    divErrosEnd.style.display = 'flex'
                    spanErrosEnd.innerHTML = texto
                })
            }
        }).catch(function (resposta) {
            console.log(`ERRO: ${resposta}`)
        })

        return false
    }
</script>